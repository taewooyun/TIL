![Image](https://e2e.ti.com/cfs-file/__key/communityserver-discussions-components-files/791/tms.PNG)

![Image](https://cdn.shopify.com/s/files/1/0615/5911/1885/files/7_c3428ffc-af30-474b-bf55-a1d3c07e5820.png?v=1757659099)

![Image](https://www.cdebyte.com/upload/image/20250915/6389355159289149367469970.png)

---

## 1. **I2S (Inter-IC Sound)**

- **ë™ê¸°ì‹ ì§ë ¬ í†µì‹  (ì˜¤ë””ì˜¤ ì „ìš©)**
- **Masterâ€“Slave êµ¬ì¡°**
- **í´ëŸ­ì€ Masterê°€ ìƒì„±**
- **ë””ì§€í„¸ ì˜¤ë””ì˜¤ ì „ì†¡ìš© ì¸í„°í˜ì´ìŠ¤**

SPI ê¸°ë°˜ í™•ì¥ êµ¬ì¡°ì´ì§€ë§Œ, **ìŒì„±/ìŒì•… ì „ìš© ê·œê²©**

---

ê¸°ì¡´ UARTì²˜ëŸ¼ start/stop bit ì—†ìŒ

â†’ **BCLK + LRCK ê¸°ì¤€ìœ¼ë¡œ ë™ê¸°í™”**

ì¢Œ/ìš° ì±„ë„ì„ êµ¬ë¶„í•´ì„œ ì—°ì† ìŠ¤íŠ¸ë¦¬ë°í•˜ëŠ” êµ¬ì¡°

---

## 2. I2S ì‹ í˜¸ì„ 

| ì‹ í˜¸ | ì˜ë¯¸ | ì„¤ëª… |
| --- | --- | --- |
| **BCLK** | Bit Clock | ë¹„íŠ¸ ë‹¨ìœ„ í´ëŸ­ |
| **LRCK (WS)** | Word Select | ì¢Œ/ìš° ì±„ë„ êµ¬ë¶„ |
| **SD** | Serial Data | ì˜¤ë””ì˜¤ ë°ì´í„° |
| **MCLK** | Master Clock | ê¸°ì¤€ í´ëŸ­ (ì˜µì…˜) |

---

### ğŸ“Œ ì£¼ìš” íŠ¹ì§•

### BCLK

- ë°ì´í„° ë¹„íŠ¸ ë™ê¸°ìš© í´ëŸ­
- 1í´ëŸ­ = 1ë¹„íŠ¸

### LRCK (WS)

- Left / Right ì±„ë„ ì„ íƒ
- `0 â†’ Left`
- `1 â†’ Right`

### SD

- ì‹¤ì œ PCM ë°ì´í„°
- MSBë¶€í„° ì „ì†¡

### MCLK

- ê³ ìŒì§ˆìš© ê¸°ì¤€ í´ëŸ­
- ëŒ€ë¶€ë¶„ ëª¨ë“ˆì€ ì—†ì–´ë„ ë¨

---

## 3. ë™ì‘ ê°œë… (í•œ ì¤„ ìš”ì•½)

```
LRCK ì „í™˜
BCLK í† ê¸€
SD ë¹„íŠ¸ ì „ì†¡
ì¢Œ/ìš° ë°˜ë³µ
```

---

- ë°˜ì´ì¤‘ êµ¬ì¡° (ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°ìš©)
- í”„ë ˆì„ ë‹¨ìœ„ ì „ì†¡
- ì—°ì† ë°ì´í„° íë¦„

ğŸ‘‰ **í•œ í”„ë ˆì„ = Left + Right ìƒ˜í”Œ**

---

## 4. I2S ë°ì´í„° íƒ€ì´ë° (ì¤‘ìš” â­)

### Philips I2S í‘œì¤€ ê¸°ì¤€

| í•­ëª© | ë‚´ìš© |
| --- | --- |
| ë¹„íŠ¸ ìˆœì„œ | MSB First |
| ì‹œì‘ ìœ„ì¹˜ | LRCK ì „í™˜ í›„ 1bit ë’¤ |
| íŒ¨ë”© | ë‚¨ëŠ” ë¹„íŠ¸ëŠ” 0 |

ğŸ“Œ í•µì‹¬:

> **LRCK ë°”ë€Œê³  â†’ í•œ ë¹„íŠ¸ ì‰¬ê³  â†’ ë°ì´í„° ì‹œì‘**
> 

ì´ê²Œ SPIë‘ ê°€ì¥ í° ì°¨ì´ì 

---

## 5. CubeIDE ì„¤ì • ìˆœì„œ (ì¤‘ìš” â­)

### 1ï¸âƒ£ SPI â†’ I2S ëª¨ë“œ ë³€ê²½

- SPI2 / SPI3 ì„ íƒ
- Mode â†’ **I2S**

---

### 2ï¸âƒ£ I2S ì„¤ì •

| í•­ëª© | ì„¤ì •ê°’ |
| --- | --- |
| Mode | Master Transmit |
| Standard | Philips I2S |
| Data Format | 16-bit |
| Audio Freq | 44.1kHz |
| MCLK | Disable |

ğŸ‘‰ ì²˜ìŒì—” ë¬´ì¡°ê±´ ìœ„ ì„¸íŒ… ì¶”ì²œ

---

### 3ï¸âƒ£ DMA ì„¤ì • (í•„ìˆ˜)

- SPIx_TX â†’ DMA Enable
- Mode: Circular / Normal
- Priority: High

ğŸ“Œ DMA ì—†ìœ¼ë©´ ì‹¤ì‹œê°„ ì²˜ë¦¬ ë¶ˆê°€

---

### 4ï¸âƒ£ GPIO

| í•€ | ì„¤ì • |
| --- | --- |
| BCLK | AF |
| LRCK | AF |
| SD | AF |

---

## 6. ì½”ë“œ íë¦„ (HAL ê¸°ì¤€)

### ê¸°ë³¸ ì „ì†¡

```c
HAL_I2S_Transmit(&hi2s2, audio_buf, BUF_SIZE, HAL_MAX_DELAY);
```

ğŸ‘‰ Blocking ë°©ì‹ (ì‹¤ë¬´ ê±°ì˜ ì•ˆ ì”€)

---

### DMA ì „ì†¡ (ì‹¤ë¬´ í‘œì¤€)

```c
HAL_I2S_Transmit_DMA(&hi2s2, audio_buf, BUF_SIZE);
```

ğŸ“Œ ì´ê²Œ ë©”ì¸ ë£¨íŠ¸

---

### í…ŒìŠ¤íŠ¸ìš© ë²„í¼

```c
#define BUF_SIZE 128

int16_t audio_buf[BUF_SIZE];

void make_test_data(void)
{
    for(int i=0;i<BUF_SIZE;i++)
    {
        audio_buf[i] = (i%32)*1000;
    }
}

```

---

## 7. ì£¼ìš” HAL í•¨ìˆ˜

### HAL_I2S_Transmit_DMA

```c
HAL_StatusTypeDef HAL_I2S_Transmit_DMA(
    I2S_HandleTypeDef *hi2s,
    uint16_t *pData,
    uint16_t Size
);

```

| ì¸ì | ì˜ë¯¸ |
| --- | --- |
| hi2s | I2S í•¸ë“¤ |
| pData | PCM ë²„í¼ |
| Size | ìƒ˜í”Œ ê°œìˆ˜ |

---

### ë°˜í™˜ê°’

| ê°’ | ì˜ë¯¸ |
| --- | --- |
| HAL_OK | ì •ìƒ |
| HAL_BUSY | DMA ì‚¬ìš©ì¤‘ |
| HAL_ERROR | ì˜¤ë¥˜ |
| HAL_TIMEOUT | ì‹œê°„ì´ˆê³¼ |

---

## 8. I2S ì‚¬ìš© íŒ¨í„´

### â–¶ ì¶œë ¥(DAC/ì•°í”„)

```
MCU â†’ I2S â†’ DAC/AMP â†’ Speaker
```

```c
ì‚¬ì¸íŒŒ/WAV â†’ ë²„í¼ â†’ DMA â†’ ì¶œë ¥
```

---

### â–¶ ì…ë ¥(MIC)

```
MIC â†’ I2S â†’ MCU â†’ ì²˜ë¦¬
```

```c
DMA ìˆ˜ì‹  â†’ í•„í„° â†’ ì €ì¥
```

---

### â–¶ ë”ë¸” ë²„í¼ êµ¬ì¡° (ì‹¤ë¬´ í•µì‹¬)

```
[BUF A] ì „ì†¡ì¤‘
[BUF B] ì¤€ë¹„ì¤‘
â†’ êµëŒ€
```

ì–¸ë”ëŸ° ë°©ì§€ìš© í•„ìˆ˜ êµ¬ì¡°

---

## 9. SPI vs I2S ë¹„êµ

| í•­ëª© | SPI | I2S |
| --- | --- | --- |
| ìš©ë„ | ë²”ìš© | ì˜¤ë””ì˜¤ ì „ìš© |
| ì±„ë„ | ììœ  | L/R ê³ ì • |
| í”„ë ˆì„ | ììœ  | ê³ ì • |
| íƒ€ì´ë° | ë‹¨ìˆœ | ì—„ê²© |
| DMA | ì„ íƒ | í•„ìˆ˜ |

---

## 10. ìì£¼ í„°ì§€ëŠ” ë¬¸ì œ

### âŒ ì†Œë¦¬ ì•ˆ ë‚¨

- I2S ì•„ë‹Œ SPI ëª¨ë“œ
- í•€ ë§¤í•‘ ì˜¤ë¥˜

### âŒ ì¡ìŒ

- ìƒ˜í”Œë ˆì´íŠ¸ ë¶ˆì¼ì¹˜
- DMA underrun

### âŒ ì¢Œìš° ì´ìƒ

- LRCK ê·¹ì„± ë¬¸ì œ

### âŒ ëŠê¹€

- ë²„í¼ í¬ê¸° ë¶€ì¡±

---

### ì°¸ê³ 

https://velog.io/@ckstn0779/Audio-MAX98357A-Speaker